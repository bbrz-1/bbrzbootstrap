<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Pies | Bethany's Pie Shop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="css/custom.css" type="text/css" />
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand fixed-top navbar-dark mb-5" style="background-color: rgb(158, 110, 204);">
        <div class="container-fluid">
          <ul class="navbar-nav">
            <li><a class="nav-link" href="/">Home</a></li>
            <li><a class="nav-link" href="pies.html">Pies</a></li>
            <li><a class="nav-link" href="contact.html">Contact</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <main class="d-flex justify-content-around p-5">
      <aside>
        <img src="images/bethanylogo.png" alt="Bethany's Pie Shop" />
      </aside>

      <article>
        <h1>Pies</h1>

        <section class="columns-desktop d-flex justify-content-around" id="pies">
          <!-- Generated HTML goes here -->
        </section>

      </article>
    </main>

  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    $(document).ready(function() {
      let pies;
      let orderArray = [];
      $.get("data/pies.json").done(function(data) {
        pies = data;

        data.forEach(element => {
          $('#pies').append(
            "<div class='d-flex flex-column bg-light m-3 p-2 border'>" 
              + `<img class='img-fluid' src='images/products/${element.id}.jpg'>` 
              + "<div class='d-flex justify-content-between'>"
              + `<span class='fw-bold'>${element.title}</span>`
              + `<span>$${element.price}</span>`
              + "</div>"
              + `<span>${element.description}</span>`
              + `<button class='orderButton btn btn-primary w-50' id='${element.id}'>Order</button>`
              + "</div>")
        });

        $('.orderButton').click(function() {
          let productId = this.id;
          orderArray.push(productId);
          console.log(orderArray);

          $.ajax({
            url: "/orders.html",
            method: "POST",
            data: {
              orders: orderArray
            },
            success: function(response) {
              alert("Success: " + response);
            },
            error: function(error) {
              alert("Error: " + error);
            }
          });

          localStorage.setItem("orders", orderArray.toString());
        });
      });
    });
  </script>
</html>
